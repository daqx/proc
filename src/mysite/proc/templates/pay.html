
{%extends "base.html"%}
{% block head %}
<!-- META HTTP-EQUIV="Refresh" CONTENT="5" > -->
<!-- META HTTP-EQUIV="Refresh" CONTENT="500" > -->
  	<link rel="stylesheet" type="text/css" media="screen" href="/proc/static/js/themes/jquery-ui.custom.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/proc/static/js/themes/ui.jqgrid.css" />
  	<script src="/proc/static/js/i18n/grid.locale-ru.js" type="text/javascript"></script>
  	<script src="/proc/static/js/jquery.jqGrid.min.js" type="text/javascript"></script> 

<script type="text/javascript">
$(function () {
	        $("#pay").jqGrid({
            	"altRows": true, 
            	"rowList": [ 10, 25, 50, 100], 
            	"sortname": "date", 
            	"viewrecords": true, 
            	"autowidth": false,            	
            	"forcefit": true, 
            	"shrinkToFit": true, 
            	"height": "auto", 
            	"caption": "Состояния агента", 
            	"datatype": "json", 
            	"gridview": true, 
            	"colModel": [
            	             {"index": "id","hidden": true},
            	             {"index": "ticket","name": "ticket", "editable": false, "label": "№ чека", 
                	            	  "width": 100,	 "formatter": extFormatLogLink},
            	             {"index": "date", "width": 130, "editable": false, 
            	            		 "name": "date", "label": "Время"},
            	             {"index": "agent__id", "hidden": true},            	            		 
            	             {"index": "agent__user__username", "width": 230, "editable": false, 
            	            		 "name": "agent__user__username", "label": "Агент"},
            	             {"index": "agent__dealer__user__username", "width": 230, "editable": false, 
                	            		 "name": "agent__dealer__user__username", "label": "Диллер"},
            	             
            	            {"index": "summa", "width": 70, "editable": false, 
                	            		 "name": "summa", "label": "сумма"},
                	        {"index": "summa_pay", "width": 70, "editable": false, 
                    	            		 "name": "summa_pay", "label": "к оплате"},
                    	    {"index": "state__name", "width": 180, "editable": false, 
                        	            		 "name": "state__name", "label": "статус"},                        	
            	            ], 
            	 "sortorder": "desc", 
            	 {% if id_%}
	        		"url": "/proc/grid/pay/{{id_}}/{{content}}",
	        	 {% else %}
            	 	"url": "/proc/grid/pay/",            		
            	 {% endif %}
            	 "rowNum": 10, 
            	 "pager": "#pager", 
            	 "jsonReader": {"repeatitems": false}
            }).navGrid('#pager', 
                {add: false, edit: false, del: false, view: true},
        {}, // edit options
        {}, // add options
        {}, // del options 
        { multipleSearch:true, closeOnEscape:true }, // search options 
        { jqModal:true, closeOnEscape:true} // view options
        ).filterToolbar({stringResult: true,searchOnEnter : false});
    
});


function extFormatLogLink(cellvalue, options, rowObject) {
	var s = '';
	
	{% if id_%}
		s = '<a href="{{content}}/'+rowObject["id"]+'" > '+cellvalue+'</a>';
	{% else %}	
		s = '<a href="'+rowObject["id"]+'" > '+cellvalue+'</a>';
	{% endif %}
		
	return s;    
}
	
</script>
{%endblock%}


{%block content%}

{% if perms.proc.add_transaction %}
	<ul class="object-tools">
		<li>
			{% if id_%}
				<a href="{% url mysite.proc.views.transaction.pay_form_add id_ content %}">	Добавить</a>
			{% else %}	
        		<a href="add">	Добавить</a>
        	{% endif %}
		</li>
	</ul>
{% endif %}<br/><br/><br/>

<table class="grid" id="pay"></table>
<div id="pager"></div>

{% endblock%}